"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var s=_superPropBase(e,t);if(s){var n=Object.getOwnPropertyDescriptor(s,t);return n.get?n.get.call(i):n.value}})(e,t,i||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(v,e,x,o,$){var t=function(){function i(){var e;return _classCallCheck(this,i),(e=_possibleConstructorReturn(this,_getPrototypeOf(i).apply(this,arguments))).label="Modal",e.doDebug=!1,e.defaults={preset:null,title:"",subtitle:"",overlayColor:"rgba(0, 0, 0, 0.4)",icon:null,iconText:null,rtl:!1,inherit:!1,width:600,height:null,top:null,bottom:null,right:null,left:null,borderBottom:!0,padding:0,ajax:null,contentAjax:null,contentAjaxCache:!0,contentSelector:null,radius:3,zindex:999,iframe:!1,iframeHeight:400,iframeWidth:800,iframeResponsive:!1,iframeURL:null,focusInput:!0,group:"",nest:!1,loop:!1,arrowKeys:!0,navigateCaption:!0,navigateArrows:!0,history:!1,restoreDefaultContent:!1,autoOpen:0,bodyOverflow:!0,fullscreen:!1,openFullscreen:!1,openTall:!1,closeOnEscape:!0,closeButton:!0,closeInBody:!1,smartActions:!0,appendTo:x.ExoModal.globalWrapper,appendToOverlay:x.ExoModal.globalWrapper,appendToNavigate:x.ExoModal.globalWrapper,class:"",appendToClosest:!1,overlay:!0,overlayClose:!0,timeout:!1,timeoutProgressbar:!1,pauseOnHover:!1,transitionIn:"comingIn",transitionOut:"comingOut",transitionInOverlay:"fadeIn",transitionOutOverlay:"fadeOut",transitionInPanel:"fadeInLeft",transitionOutPanel:"fadeOutLeft",onFullscreen:function(){},onResize:function(){},onOpening:function(){},onOpened:function(){},onClosing:function(){},onClosed:function(){},afterRender:function(){}},e.inheritExclude=["id","inherit","title","subtitle","icon","iconText","ajax","contentAjax","iframeUrl","_exoTime"],e.events={opening:new ExoEvent,opened:new ExoEvent,closing:new ExoEvent,closed:new ExoEvent},e.states={CLOSING:"closing",CLOSED:"closed",OPENING:"opening",OPENED:"opened",DESTROYED:"destroyed"},e.name="exo-modal",e.built=!1,e.width=0,e.widthOffset=0,e.timer=null,e.timerTimeout=null,e.progressBar=null,e.isPaused=!1,e.isFullscreen=!1,e.isCompressed=!1,e.isTall=!1,e.isSetHeight=!1,e.headerHeight=0,e.footerHeight=0,e.modalHeight=0,e.autoOpenProcessed=!1,e.panelOpen=!1,e.contentAjaxLoaded=!1,e}return _inherits(i,ExoData),_createClass(i,[{key:"build",value:function(t){var n=this;return new Promise(function(s,e){t.preset&&"object"===_typeof(o.exoModal.presets)&&o.exoModal.presets[t.preset]&&(t=jQuery.extend(!0,{},t,o.exoModal.presets[t.preset])),t=jQuery.extend(!0,{},x.ExoModal.getSettingsGroup("defaults"),t),_get(_getPrototypeOf(i.prototype),"build",n).call(n,t,!1).then(function(e){if(null!==e){n.debug("log","Build: Act","["+n.id+"]",e);var t=n.getTriggerElement().once("exo.modal");t.length&&(n.debug("log","Build: Bind Trigger","["+n.id+"]"),n.bindTrigger());var i=n.getElement().once("exo.modal");i.length&&(n.debug("log","Build: Found Element","["+n.id+"]"),n.state=n.states.CLOSED,n.get("contentAjax")&&(n.$contentAjaxPlaceholder=v('<div class="exo-modal-ajax-placeholder hidden" />').insertBefore(i))),t.length||i.length?s(e):s(null)}else s(e)},e)})}},{key:"afterBuild",value:function(){var e=this;if(this.getElement().length)if(this.get("autoOpen"))x.Exo.isInitialized()?this.open():x.Exo.event("ready").on("exo.modal."+this.getId(),function(){x.Exo.event("ready").off("exo.modal."+e.getId()),e.open()});else if(this.getElement().find(".exo-form-container-error").length){this.open();var t=v(".messages.error");t.length&&!t.closest(".exo-modal").length&&this.$content.prepend(t)}}},{key:"rebuildContent",value:function(){return this.built=!1,this}},{key:"refreshContent",value:function(){this.$content.find(".messages").length&&this.$wrap.scrollTop(0),this.createFooter()}},{key:"buildContent",value:function(){var i=this;if(this.$element&&this.$element.length&&!this.built){if(this.built=!0,this.debug("log","Build","["+this.getId()+"]",this.getData()),!0===this.get("inherit")){var e=x.ExoModal.getVisibleFocus();if(e){for(var t=this.$element[0].classList.length-1;0<=t;t--){var s=this.$element[0].classList[t];s.startsWith("exo-modal-theme-")&&this.$element[0].classList.remove(s)}for(var n=e.$element[0].classList.length-1;0<=n;n--){var o=e.$element[0].classList[n];o.startsWith("exo-modal-theme-")&&this.$element.addClass(o)}jQuery.each(e.getData(),function(e,t){-1===i.inheritExclude.indexOf(String(e))&&(i.data[e]=t)}),this.set("zindex",e.get("zindex")+1)}}this.$element.hasClass(this.name+"-hidden")&&this.$element.removeClass(this.name+"-hidden"),""!==this.get("class")&&this.$element.addClass(this.get("class"));var a=this.$element.closest(".exo-form");if(a.length)for(var l=a[0].classList.length-1;0<=l;l--){var r=a[0].classList[l];r.startsWith("exo-form")&&this.$element.addClass(r)}if(this.class=void 0!==this.$element.attr("class")?this.$element.attr("class"):"",this.content=this.$element.html(),this.$overlay=v('<div class="'+this.name+'-overlay" style="background-color:'+this.get("overlayColor")+'"></div>'),this.$navigate=v('<div class="'+this.name+'-navigate"><div class="'+this.name+'-navigate-caption">Use</div><button class="'+this.name+'-navigate-prev"></button><button class="'+this.name+'-navigate-next"></button></div>'),this.$element.attr("aria-hidden","true"),this.$element.attr("aria-labelledby",this.getId()),this.$element.attr("role","dialog"),this.$container=this.$element.find("."+this.name+"-container").first(),this.$content=this.$element.find("."+this.name+"-content").first(),this.$sectionHeader=this.$element.find("."+this.name+"-section-header"),this.$sectionFooter=this.$element.find("."+this.name+"-section-footer"),this.$element.hasClass(this.name)||this.$element.addClass(this.name),""!==this.get("group")&&this.$element.attr("data-"+this.name+"-group",this.get("group")),!0===this.get("loop")&&this.$element.attr("data-"+this.name+"-loop","true"),!1!==this.get("appendTo")&&(!0===this.get("appendToClosest")?this.$element.appendTo(this.$element.closest(this.get("appendTo"))):this.$element.appendTo(this.get("appendTo")),this.$element.closest(".exo-content").length&&this.$element.css({top:$.offsets.top,bottom:$.offsets.bottom,left:$.offsets.left,right:$.offsets.right})),!0===this.get("iframe")&&(this.$content.html('<iframe class="'+this.name+'-iframe"></iframe>'),null!==this.get("iframeHeight")))if(null!==this.get("iframeHeight")&&null!==this.get("iframeWidth")&&!0===this.get("iframeResponsive")){var h=this.getIframeResponsivePadding();this.$content.find("."+this.name+"-iframe").css("width","100%").wrap('<div class="'+this.name+'-iframe-responsive" />'),this.$content.find("."+this.name+"-iframe-responsive").css("padding-bottom",h+"%")}else this.$content.find("."+this.name+"-iframe").css("height",this.get("iframeHeight"));if(this.$wrap=this.$element.find("."+this.name+"-wrap").first(),null!==this.get("zindex")&&this.setZindex(this.get("zindex")),""!==this.get("radius")&&this.$element.css("border-radius",this.get("radius")),""!==this.get("padding")&&0!==this.get("padding")&&this.$content.css("padding",this.get("padding")),!0===this.get("rtl")&&this.$element.addClass(this.name+"-rtl"),!1!==this.get("openFullscreen")&&(this.isFullscreen=!0,this.$element.addClass("isFullscreen")),this.get("height")&&(this.isSetHeight=!0,this.$element.addClass("isSetHeight")),!0===this.get("openTall")&&(this.isTall=!0,this.$element.addClass("isTall")),!1!==this.get("closeInBody")){var d=v('<div class="exo-container-button '+this.get("closeInBody")+'"><a href="javascript:void(0)" class="'+this.name+"-button "+this.name+'-button-close" data-'+this.name+"-close></a></div>");this.$container.prepend(d),setTimeout(function(){i.widthOffset+=d.outerWidth()})}this.createHeader(),this.createFooter(),this.buildPanels(),this.recalcSize(),this.recalcVerticalPos(),this.recalcHorizontalPos(),this.callCallback("afterRender")}}},{key:"setZindex",value:function(e){e+=3*x.ExoModal.getVisible(!0).count(),this.set("zindex",e),this.$overlay.css("z-index",e-2),this.$navigate.css("z-index",e-1),this.$element.css("z-index",e)}},{key:"createHeader",value:function(){this.$element.find("."+this.name+"-header").remove(),this.$header=v('<div class="'+this.name+'-header"><h2 class="'+this.name+'-header-title">'+this.get("title")+'</h2><p class="'+this.name+'-header-subtitle"><span>'+this.get("subtitle")+'</span></p><div class="'+this.name+'-header-buttons"></div></div>'),""===this.get("subtitle")&&this.$header.addClass(this.name+"-no-subtitle"),!0===this.get("fullscreen")&&this.$header.find("."+this.name+"-header-buttons").append('<a href="javascript:void(0)" class="'+this.name+"-button "+this.name+'-button-fullscreen" data-'+this.name+"-fullscreen></a>"),!0===this.get("closeButton")&&this.$header.find("."+this.name+"-header-buttons").append('<a href="javascript:void(0)" class="'+this.name+"-button "+this.name+'-button-close" data-'+this.name+"-close></a>"),!0===this.get("timeoutProgressbar")&&this.$header.prepend('<div class="'+this.name+'-progressbar"><div></div></div>'),this.$element.css("border-bottom-width",""),(""!==this.get("title")||!0===this.get("closeButton")||this.get("fullscreen")||this.get("timeoutProgressbar"))&&(!0===this.get("borderBottom")&&this.$element.css("border-bottom-width","3px"),null===this.get("icon")&&null===this.get("iconText")||(this.$header.prepend('<i class="'+this.name+'-header-icon"></i>'),null!==this.get("icon")&&this.$header.find("."+this.name+"-header-icon").addClass(this.get("icon")),null!==this.get("iconText")&&this.$header.find("."+this.name+"-header-icon").html(this.get("iconText"))),this.get("closeInBody")||this.$element.css("overflow","hidden").prepend(this.$header))}},{key:"createFooter",value:function(){var n=this;if(this.$element.find("."+this.name+"-footer").remove(),this.$element.removeClass("has-footer"),!0===this.get("smartActions")){var e=this.$element.find(".form-actions");e.length?e.last().addClass("exo-modal-actions"):this.$element.find(".exo-form-container-button--primary").addClass("exo-modal-actions"),e.removeClass("exo-form-element"),this.$footer=v('<div class="'+this.name+'-footer"></div>'),v(".exo-modal-views-view .exo-form-container-form-actions").addClass("exo-modal-actions");var t=this.$element.find(".exo-modal-actions:last input, .exo-modal-actions button, .exo-modal-actions a");if(t.length&&(this.$element.addClass("has-footer"),this.$element.append(this.$footer),this.$element.css("border-bottom-width",0),this.set("borderBottom",!1),t.length)){var o=function(e,t){var i=t.text().toLowerCase();t.is("a")?"cancel"===i?n.close():window.location.href=t.attr("href"):t.trigger("mousedown").trigger("mouseup").trigger("click")},a=t.filter(".button--primary");t.each(function(i,e){var s=v(e),t=a.length?s.hasClass("button--primary"):0===i;s.clone().attr("id",s.attr("id")?s.attr("id")+"-clone":"").attr("name",s.attr("name")?s.attr("name")+"-clone":"").attr("data-drupal-selector",s.attr("data-drupal-selector")?s.attr("data-drupal-selector")+"-clone":"").removeAttr("class").addClass("exo-modal-action"+(t?" primary":"")).on("click",function(e){e.preventDefault();var t=s.data("exo-modal-action-delay");t?void 0!==n.events[t]?n.event(t).on("exo.modal.footer."+i,function(e){n.event(t).off("exo.modal.footer."+i),o(0,s)}):t===parseInt(t)&&setTimeout(function(){o(0,s)},t):setTimeout(function(){o(0,s)})}).appendTo(n.$footer)}),t.closest(".exo-form-element-type-actions").addClass("exo-modal-hide"),t.closest(".exo-modal-actions").addClass("exo-modal-hide"),t.closest(".exo-form-container-exo-modal-actions").addClass("exo-modal-hide")}}}},{key:"buildPanels",value:function(){var n=this,e=this.$element.find(".exo-modal-panel-trigger").once("exo.modal");e.length&&(e.each(function(e,t){var i=v(t),s=i.data("exo-modal-panel");n.$element.find(".exo-modal-panel[data-exo-modal-panel="+s+"]").hide();i.find(".hide").hide(),i.on("click.exo.modal",function(e){e.preventDefault(),i.hasClass("active")?n.hidePanel(i):(n.hidePanels(),n.showPanel(i))})}),this.event("closed").on("exo.modal.panels",function(e){n.hidePanels(!1)}))}},{key:"showPanel",value:function(t,e){var i=this;this.panelOpen=!0;var s=t.data("exo-modal-panel"),n=this.$element.find(".exo-modal-panel[data-exo-modal-panel="+s+"]");t.data("exo-modal-width",this.get("width"));var o=t.data("exo-modal-panel-width");o&&this.setWidth(o);var a=this.get("transitionInPanel"),l=this.get("transitionOutPanel");!1!==e&&a&&l&&void 0!==x.Exo.animationEvent?(n.show().addClass("transitionIn exo-animate-"+a),this.$content.addClass("transitionOut exo-animate-"+l),n.on(x.Exo.animationEvent+".exo.modal",function(e){n.get(0)===e.currentTarget&&(n.off(x.Exo.animationEvent+".exo.modal"),n.removeClass("exo-animate-"+a+" transitionIn"),i.$content.removeClass("exo-animate-"+l+" transitionOut"),n.addClass("active"))}),t.addClass("transitionOut exo-animate-"+l),t.on(x.Exo.animationEvent+".exo.modal",function(e){t.get(0)===e.currentTarget&&(t.off(x.Exo.animationEvent+".exo.modal"),t.removeClass("transitionOut exo-animate-"+l),t.find(".show").hide(),t.find(".hide").show(),t.addClass("active"),t.addClass("transitionIn exo-animate-"+a),t.on(x.Exo.animationEvent+".exo.modal",function(e){t.get(0)===e.currentTarget&&t.off(x.Exo.animationEvent+".exo.modal")}))})):(t.find(".show").hide(),t.find(".hide").show(),t.removeClass("active"),n.show().addClass("active"))}},{key:"hidePanel",value:function(t,e){var i=this;this.panelOpen=!1;var s=t.data("exo-modal-panel"),n=this.$element.find(".exo-modal-panel[data-exo-modal-panel="+s+"]");this.setWidth(t.data("exo-modal-width"));var o=this.get("transitionInPanel"),a=this.get("transitionOutPanel");!1!==e&&o&&a&&void 0!==x.Exo.animationEvent?(n.addClass("transitionOut exo-animate-"+a),this.$content.addClass("transitionIn exo-animate-"+o),n.on(x.Exo.animationEvent+".exo.modal",function(e){n.get(0)===e.currentTarget&&(n.off(x.Exo.animationEvent+".exo.modal"),n.removeClass("exo-animate-"+a+" transitionOut"),i.$content.removeClass("exo-animate-"+o+" transitionIn"),n.hide().removeClass("active"))}),t.addClass("transitionOut exo-animate-"+a),t.on(x.Exo.animationEvent+".exo.modal",function(e){t.get(0)===e.currentTarget&&(t.off(x.Exo.animationEvent+".exo.modal"),t.removeClass("transitionOut exo-animate-"+a),t.find(".show").show(),t.find(".hide").hide(),t.removeClass("active"),t.addClass("transitionIn exo-animate-"+o),t.on(x.Exo.animationEvent+".exo.modal",function(e){t.get(0)===e.currentTarget&&t.off(x.Exo.animationEvent+".exo.modal")}))})):(t.find(".show").show(),t.find(".hide").hide(),t.removeClass("active"),n.hide().removeClass("active"))}},{key:"hidePanels",value:function(e){if(this.hasOpenPanel()){var t=this.$element.find(".exo-modal-panel-trigger.active");t.length&&this.hidePanel(t,e)}}},{key:"hasOpenPanel",value:function(){return!0===this.panelOpen}},{key:"set",value:function(e,t){switch(_get(_getPrototypeOf(i.prototype),"set",this).call(this,e,t),e){case"title":case"closeButton":case"fullscreen":case"subtitle":case"borderBottom":case"icon":case"iconText":this.createHeader(),this.bindElement()}return this}},{key:"getIframeResponsivePadding",value:function(){var e=0,t=parseInt(this.get("iframeWidth")),i=parseInt(this.get("iframeHeight"));return i<t&&(e=i/t*100),t<i&&(e=t/i*100),e}},{key:"setWidth",value:function(e){this.set("width",e),this.recalcSize()}},{key:"recalcSize",value:function(){var e=x.Exo.$window.width()-$.offsets.left-$.offsets.right,t=null!==this.get("left")&&!1!==this.get("left")&&""!==this.get("left")&&null!==this.get("right")&&!1!==this.get("right")&&""!==this.get("right")?e-(x.Exo.getMeasurementValue(this.get("left"))||0)-(x.Exo.getMeasurementValue(this.get("right"))||0):this.get("width");this.$element.css("max-width",t);var i=this.get("height");i&&this.$element.css("max-height",i),e<t+this.widthOffset?(this.isCompressed=!0,this.$element.addClass("isCompressed")):(this.isCompressed=!1,this.$element.removeClass("isCompressed")),x.Exo.isIE()&&1<t.toString().split("%").length&&(t=this.$element.outerWidth())}},{key:"recalcVerticalPos",value:function(e){null!==this.get("top")&&!1!==this.get("top")?(this.$element.css("margin-top",this.get("top")),0===this.get("top")&&this.$element.css({borderTopRightRadius:0,borderTopLeftRadius:0})):!1===e&&this.$element.css({marginTop:"",borderRadius:this.get("radius")}),null!==this.get("bottom")&&!1!==this.get("bottom")?(this.$element.css("margin-bottom",this.get("bottom")),0===this.get("bottom")&&this.$element.css({borderBottomRightRadius:0,borderBottomLeftRadius:0})):!1===e&&this.$element.css({marginBottom:"",borderRadius:this.get("radius")})}},{key:"recalcHorizontalPos",value:function(e){null!==this.get("left")&&!1!==this.get("left")?(this.$element.css("margin-left",this.get("left")),0===this.get("left")&&this.$element.css({borderTopLeftRadius:0,borderBottomLeftRadius:0})):!1===e&&this.$element.css({marginLeft:"",borderRadius:this.get("radius")}),null!==this.get("right")&&!1!==this.get("right")?(this.$element.css("margin-right",this.get("right")),0===this.get("right")&&this.$element.css({borderTopRightRadius:0,borderBottomRightRadius:0})):!1===e&&this.$element.css({marginRight:"",borderRadius:this.get("radius")})}},{key:"toggle",value:function(){this.state==this.states.OPENED&&this.close(),this.state==this.states.CLOSED&&this.open()}},{key:"shouldAutoOpen",value:function(){return this.get("autoOpen")&&!1===this.autoOpenProcessed}},{key:"autoOpen",value:function(){var e=this;this.shouldAutoOpen()&&this.$element.length&&(this.debug("Auto Open",this),this.autoOpenProcessed=!0,setTimeout(function(){e.open()}))}},{key:"callCallback",value:function(e){var t=this.get(e);if(t)if("string"==typeof t){var i=x.Exo.stringToCallback(t);i&&i.object[i.function](this)}else"function"!=typeof t&&"object"!==_typeof(t)||t(this);x.Exo.$window.trigger("exo-modal:"+e,[this])}},{key:"toggleContentSelector",value:function(){this.get("contentSelector")&&(this.state==this.states.CLOSED?(this.$contentPlaceholder||(this.$contentPlaceholder=v('<div class="exo-modal-placeholder data-exo-modal-placeholder="'+this.get("contentSelector")+'"></div>')),this.$contentSelection=v(this.get("contentSelector")),this.$contentSelection.length&&(this.$content=this.$element.find("."+this.name+"-content"),this.$contentPlaceholder.insertBefore(this.$contentSelection),this.$contentSelection.appendTo(this.$content))):(this.$contentSelection.insertBefore(this.$contentPlaceholder),this.$contentPlaceholder.remove()))}},{key:"open",value:function(e){var i=this;if(this.state==this.states.CLOSED&&(this.debug("log","Open","["+this.getId()+"]",this.getData()),this.get("contentAjax")&&!1===this.contentAjaxLoaded&&!0===this.get("contentAjaxCache")&&(this.contentAjaxLoaded=!0,this.$trigger.off("click.exo.modal."+this.getId()),this.bindTrigger()),this.toggleContentSelector(),this.buildContent(),x.ExoDisplace.calculate(),!0!==this.get("nest")&&x.ExoModal.closeAll(),this.state=this.states.OPENING,this.$element.trigger(this.states.OPENING),this.$element.attr("aria-hidden","false"),!0===this.get("timeoutProgressbar")&&this.$element.find("."+this.name+"-progressbar > div").width("100%"),!0===this.get("iframe"))){this.$content.addClass(this.name+"-content-loader");var s=this.$element.find("."+this.name+"-iframe");s.on("load.exo.modal",function(e){var t=e.target;s.parent().removeClass(i.name+"-content-loader"),t.contentWindow.focus()});var t=null;try{t=""!==v(e.currentTarget).attr("href")?v(e.currentTarget).attr("href"):null}catch(e){}if(null!==this.get("iframeURL")&&null==t&&(t=this.get("iframeURL")),null==t)throw new Error("Failed to find iframe URL");s.attr("src",t)}(this.get("bodyOverflow")||x.Exo.isMobile())&&x.Exo.lockOverflow(this.$wrap),this.doOpen(e),!1===this.get("timeout")||isNaN(parseInt(this.get("timeout")))||!1===this.get("timeout")||0===this.get("timeout")||this.startProgress(this.get("timeout")),this.get("overlayClose")&&!this.$element.hasClass(this.get("transitionOut"))&&this.$overlay.on("click.exo.modal",function(){i.close()});!function e(){i.recalcLayout(),i.timer=setTimeout(e,300)}()}},{key:"doOpen",value:function(e){var t=this;this.debug("log","Do Open","["+this.getId()+"]",e);var i=x.ExoModal.getGrouped(this.get("group"));if(this.$trigger.trigger("blur"),this.$element.closest("#exo-modals").length||v(".exo-fixed-float:not(.exo-fixed-not-invisible)").addClass("exo-fixed-invisible"),1<i.count()){var s=i.getPrev(this.getId(),this.get("loop")),n=i.getNext(this.getId(),this.get("loop"));!1===this.get("appendToNavigate")?this.$navigate.appendTo("body"):(!0===this.get("appendToClosest")?this.$navigate.appendTo(this.$element.closest(this.get("appendToNavigate"))):this.$navigate.appendTo(this.get("appendToNavigate")),this.$navigate.closest(".exo-content").length&&this.$navigate.css({top:$.offsets.top,bottom:$.offsets.bottom,left:$.offsets.left,right:$.offsets.right})),this.$navigate.addClass("fadeIn"),!0===this.get("navigateCaption")&&(null!==this.get("left")&&!1!==this.get("left")?this.$navigate.find("."+this.name+"-navigate-caption").css("right","10px").show():this.$navigate.find("."+this.name+"-navigate-caption").css("left","10px").show());var o=this.$element.outerWidth();!1!==this.get("navigateArrows")?"closeScreenEdge"===this.get("navigateArrows")?(this.$navigate.find("."+this.name+"-navigate-prev").css("left",0).show(),this.$navigate.find("."+this.name+"-navigate-next").css("right",0).show()):(this.$navigate.find("."+this.name+"-navigate-prev").css("margin-left",-(o/2+84)).show(),this.$navigate.find("."+this.name+"-navigate-next").css("margin-right",-(o/2+84)).show()):(this.$navigate.find("."+this.name+"-navigate-prev").hide(),this.$navigate.find("."+this.name+"-navigate-next").hide()),s||this.$navigate.find("."+this.name+"-navigate-prev").hide(),n||this.$navigate.find("."+this.name+"-navigate-next").hide()}!0===this.get("overlay")&&(!1===this.get("appendToOverlay")?this.$overlay.prependTo(this.$element.parent()):(!0===this.get("appendToClosest")?this.$overlay.prependTo(this.$element.closest(this.get("appendToOverlay"))):this.$overlay.prependTo(this.get("appendToOverlay")),this.$overlay.closest(".exo-content").length&&this.$overlay.css({top:$.offsets.top,bottom:$.offsets.bottom,left:$.offsets.left,right:$.offsets.right}))),this.get("transitionInOverlay")&&this.$overlay.addClass(this.get("transitionInOverlay"));var a=this.get("transitionIn");"object"==_typeof(e)&&(void 0===e.transition&&void 0===e.transitionIn||(a=e.transition||e.transitionIn),void 0!==e.zindex&&this.setZindex(e.zindex)),""!==a&&void 0!==x.Exo.animationEvent?(this.$element.addClass("transitionIn "+a).css("display","flex"),this.event("opening").trigger(this),this.callCallback("onOpening"),this.$wrap.on(x.Exo.animationEvent+".exo.modal",function(e){t.$wrap.get(0)===e.currentTarget&&(t.$wrap.off(x.Exo.animationEvent+".exo.modal"),t.$element.removeClass(a+" transitionIn"),t.$overlay.removeClass(t.get("transitionInOverlay")),t.$navigate.removeClass("fadeIn"),t.opened())})):(this.$element.css("display","flex"),this.event("opening").trigger(this),this.callCallback("onOpening"),this.opened()),!0!==this.get("pauseOnHover")||!0!==this.get("pauseOnHover")||!1===this.get("timeout")||isNaN(parseInt(this.get("timeout")))||!1===this.get("timeout")||0===this.get("timeout")||(this.$element.off("mouseenter").on("mouseenter.exo.modal",function(e){e.preventDefault(),t.isPaused=!0}),this.$element.off("mouseleave").on("mouseleave.exo.modal",function(e){e.preventDefault(),t.isPaused=!1})),setTimeout(function(){t.$wrap.scrollTop(0),!0!==t.get("iframe")&&(t.get("focusInput")?t.$element.find(":input:not(button):enabled:visible:first").trigger("focus").filter("input:text").trigger("select"):t.$element.trigger("focus"))})}},{key:"opened",value:function(){var t=this;this.bindElement(),this.state=this.states.OPENED,this.$element.trigger(this.states.OPENED),this.event("opened").trigger(this),this.callCallback("onOpened"),this.$element.addClass("isOpen"),x.Exo.$document.on("keydown."+this.name,function(e){switch(e.which){case 27:t.close()}}),void 0!==x.drimage&&setTimeout(function(){x.drimage.init(t.$element.get(0))})}},{key:"close",value:function(e){var t=this;if(this.state==this.states.OPENED||this.state==this.states.OPENING){x.Exo.$document.off("keydown."+this.name),this.get("autoOpen")&&(this.dataOriginal={}),this.state=this.states.CLOSING,this.$element.trigger(this.states.CLOSING),this.$element.attr("aria-hidden","true"),this.$element.closest("#exo-modals").length||v(".exo-fixed-float:not(.exo-fixed-not-invisible)").removeClass("exo-fixed-invisible"),clearTimeout(this.timer),clearTimeout(this.timerTimeout),this.event("closing").trigger(this),this.callCallback("onClosing");var i=this.get("transitionOut");"object"==_typeof(e)&&(void 0===e.transition&&void 0===e.transitionOut||(i=e.transition||e.transitionOut)),!1===i||""===i||void 0===x.Exo.animationEvent?(this.$element.hide(),this.$overlay.remove(),this.$navigate.remove(),this.closed()):(this.$element.attr("class",[this.class,this.name,i,!0===this.isFullscreen?"isFullscreen":"",!0===this.isCompressed?"isCompressed":"",this.isSetHeight?"isSetHeight":"",!0===this.isTall?"isTall":"",this.get("rtl")?this.name+"-rtl":""].join(" ")),this.$overlay.attr("class",this.name+"-overlay "+this.get("transitionOutOverlay")),!1===this.get("navigateArrows")||x.Exo.isMobile()||this.$navigate.attr("class",this.name+"-navigate fadeOut"),this.$element.on(x.Exo.animationEvent+".exo.modal",function(e){e.target===e.currentTarget&&(t.$element.off(x.Exo.animationEvent+".exo.modal"),t.$element.hasClass(i)&&t.$element.removeClass(i+" transitionOut").hide(),t.$overlay.removeClass(t.get("transitionOutOverlay")).remove(),t.$navigate.removeClass("fadeOut").remove(),t.closed())}))}}},{key:"closed",value:function(){this.toggleContentSelector(),this.state=this.states.CLOSED,this.$element.trigger(this.states.CLOSED),!0===this.get("iframe")&&this.$element.find("."+this.name+"-iframe").attr("src",""),(this.get("bodyOverflow")||x.Exo.isMobile())&&0===x.ExoModal.getVisible().count()&&x.Exo.unlockOverflow(this.$wrap),this.event("closed").trigger(this),this.callCallback("onClosed"),this.$element.removeClass("isOpen"),!0===this.get("restoreDefaultContent")&&this.$content.html(this.content),0===v("."+this.name+":visible").length&&v("html").removeClass(this.name+"-isAttached"),this.get("contentAjax")&&(this.$element.insertAfter(this.$contentAjaxPlaceholder),this.rebuildContent()),this.get("destroyOnClose")&&this.destroy()}},{key:"destroy",value:function(){this.debug("log","Destroy","["+this.getId()+"]");var e=v.Event("destroy");this.$element.trigger(e),x.Exo.$document.off("keydown."+this.name),clearTimeout(this.timer),clearTimeout(this.timerTimeout),!0===this.get("iframe")&&this.$element.find("."+this.name+"-iframe").remove(),x.detachBehaviors(this.$element.get(0),o),this.$element.html(this.$content.html()),this.$element.off("click","[data-"+this.name+"-close]"),this.$element.off("click","[data-"+this.name+"-fullscreen]"),this.$element.off("."+this.name).removeData(this.name).attr("style","").remove(),this.$contentAjaxPlaceholder&&this.$contentAjaxPlaceholder.remove(),this.$contentAjaxPlaceholder=null,this.contentAjaxLoaded=!1,this.$overlay.remove(),this.$navigate.remove(),this.$element.trigger(this.states.DESTROYED),this.$element=null,this.autoOpenProcessed=!1,this.state=this.states.CLOSED,this.built=!1}},{key:"bindElement",value:function(){var i=this;this.$element.find("[data-"+this.name+"-close]").off("click.exo.modal").on("click.exo.modal",function(e){e.preventDefault();var t=v(e.currentTarget).attr("data-"+i.name+"-transitionOut");void 0!==t?i.close({transition:t}):i.close()}).attr("tabindex",0).attr("aria-label","Close modal"),this.$element.off("click.exo.modal","[data-"+this.name+"-fullscreen]").on("click.exo.modal","[data-"+this.name+"-fullscreen]",function(e){e.preventDefault(),!0===i.isFullscreen?(i.isFullscreen=!1,i.$element.addClass("exo-no-transitions").removeClass("isFullscreen")):(i.isFullscreen=!0,i.$element.addClass("exo-no-transitions isFullscreen")),setTimeout(function(){i.$element.removeClass("exo-no-transitions")},300),x.Exo.checkElementPosition(),i.$element.trigger("fullscreen",i),i.callCallback("onFullscreen")}),this.$navigate.off("click.exo.modal","."+this.name+"-navigate-next").on("click.exo.modal","."+this.name+"-navigate-next",function(e){e.preventDefault(),i.next(e)}),this.$element.off("click.exo.modal","[data-"+this.name+"-next]").on("click.exo.modal","[data-"+this.name+"-next]",function(e){e.preventDefault(),i.next(e)}),this.$navigate.off("click.exo.modal","."+this.name+"-navigate-prev").on("click.exo.modal","."+this.name+"-navigate-prev",function(e){e.preventDefault(),i.prev(e)}),this.$element.off("click.exo.modal","[data-"+this.name+"-prev]").on("click.exo.modal","[data-"+this.name+"-prev]",function(e){e.preventDefault(),i.prev(e)})}},{key:"startProgress",value:function(e){var t=this;this.isPaused=!1,clearTimeout(this.timerTimeout),!0===this.get("timeoutProgressbar")?(this.progressBar={hideEta:null,maxHideTime:null,currentTime:(new Date).getTime(),el:this.$element.find("."+this.name+"-progressbar > div"),updateProgress:function(){if(!t.isPaused){t.progressBar.currentTime=t.progressBar.currentTime+10;var e=(t.progressBar.hideEta-t.progressBar.currentTime)/t.progressBar.maxHideTime*100;t.progressBar.el.width(e+"%"),e<0&&t.close()}}},0<e&&(this.progressBar.maxHideTime=parseFloat(e),this.progressBar.hideEta=(new Date).getTime()+this.progressBar.maxHideTime,this.timerTimeout=setInterval(this.progressBar.updateProgress,10))):this.timerTimeout=setTimeout(function(){t.close()},this.get("timeout"))}},{key:"pauseProgress",value:function(){this.isPaused=!0}},{key:"resumeProgress",value:function(){this.isPaused=!1}},{key:"resetProgress",value:function(e){clearTimeout(this.timerTimeout),this.progressBar={},this.$element.find("."+this.name+"-progressbar > div").width("100%")}},{key:"recalcLayout",value:function(){var e=this;if(this.state==this.states.OPENED||this.state==this.states.OPENING){var t=x.Exo.$window.height()-($.offsets.top+$.offsets.bottom),i=x.Exo.$window.width()-($.offsets.left+$.offsets.right),s=this.$element.outerHeight(),n=this.$element.outerWidth(),o=this.$content[0].scrollHeight,a=this.$sectionHeader.outerHeight()||0,l=this.$sectionFooter.outerHeight()||0,r=this.$wrap.scrollTop(),h=this.$content.innerHeight()-this.$content.height(),d=this.$content.innerWidth()-this.$content.width(),c=0,g=!1;x.Exo.isIE()&&(n>=x.Exo.$window.width()||!0===this.isFullscreen)&&this.$element.css({left:"0",marginLeft:""}),!0===this.get("borderBottom")&&""!==this.get("title")&&(c=3),this.headerHeight=0,this.$element.find("."+this.name+"-header").length&&this.$element.find("."+this.name+"-header").is(":visible")&&(this.headerHeight=this.$element.find("."+this.name+"-header").innerHeight()),this.footerHeight=0,this.$element.find("."+this.name+"-footer").length&&this.$element.find("."+this.name+"-footer").is(":visible")&&(this.footerHeight=this.$element.find("."+this.name+"-footer").innerHeight());var m=this.headerHeight+this.footerHeight+a+l,u=this.$element.outerHeight()-m,f=0;if(this.isSetHeight?(f=s,g=!0):f=o+m,this.$element.find("."+this.name+"-loader").length&&this.$element.find("."+this.name+"-loader").css("top",this.headerHeight),s!==this.modalHeight&&(this.modalHeight=s,this.callCallback("onResize")),!0===this.get("iframe"))if(null!==this.get("iframeHeight")&&null!==this.get("iframeWidth")&&!0===this.get("iframeResponsive"))if(t<=this.$element.outerHeight()||!0===this.isFullscreen){var p=t/this.$element.outerHeight();this.$element.css("max-width",this.$element.width()*p)}else this.recalcSize();else t<this.get("iframeHeight")+m+c||!0===this.isFullscreen?this.$element.find("."+this.name+"-iframe").css("height",Math.round(t-(m+c+h))):this.$element.find("."+this.name+"-iframe").css("height",this.get("iframeHeight"));else 1===this.$element.find("."+this.name+"-expand:visible").length?(this.$element.find("."+this.name+"-expand").height(t-(m+c+h)).width(i-d),this.$element.css("max-width","")):this.recalcSize();s==t?this.$element.addClass("isAttached"):this.$element.removeClass("isAttached"),!1===this.isFullscreen&&this.$element.width()>=x.Exo.$window.width()?this.$element.find("."+this.name+"-button-fullscreen").hide():this.$element.find("."+this.name+"-button-fullscreen").show(),this.recalcButtons(),!1===this.isFullscreen&&(t=t-(x.Exo.getMeasurementValue(this.get("top"))||0)-(x.Exo.getMeasurementValue(this.get("bottom"))||0)),t<f?(0<this.get("top")&&null===this.get("bottom")&&o<x.Exo.$window.height()&&this.$element.addClass("isAttachedBottom"),0<this.get("bottom")&&null===this.get("top")&&o<x.Exo.$window.height()&&this.$element.addClass("isAttachedTop"),1===v("."+this.name+":visible").length&&v("html").addClass(this.name+"-isAttached"),this.$element.css("height",t)):(!0===this.isTall?this.$element.css("height",t):this.get("top")&&this.get("bottom")?this.$element.css("height",t):this.isSetHeight||this.$element.css("height",o+(m+c)),this.$element.removeClass("isAttachedTop isAttachedBottom"),1===v("."+this.name+":visible").length&&v("html").removeClass(this.name+"-isAttached")),u<o&&(g||t<f)?(e.$element.addClass("hasScroll"),e.$wrap.css("height",s-(m+c))):(e.$element.removeClass("hasScroll"),e.$wrap.css("height","")),u+r<o-30?e.$element.addClass("hasShadow"):e.$element.removeClass("hasShadow")}}},{key:"recalcButtons",value:function(){var e=this.$header.find("."+this.name+"-header-buttons").innerWidth()+10;!0===this.get("rtl")?this.$header.css("padding-left",e):this.$header.css("padding-right",e)}},{key:"next",value:function(e){var t=x.ExoModal.getGrouped(this.get("group")).getNext(this.getId(),this.get("loop"));if(t){var i=this.get("transitionOut")===this.defaults.transitionOut?"fadeOutLeft":this.get("transitionOut"),s=t.get("transitionIn")===this.defaults.transitionIn?"fadeInRight":t.get("transitionIn");this.close({transition:i}),setTimeout(function(){t.open({transition:s})},200)}}},{key:"prev",value:function(e){var t=x.ExoModal.getGrouped(this.get("group")).getPrev(this.getId(),this.get("loop"));if(t){var i=this.get("transitionOut")===this.defaults.transitionOut?"fadeOutRight":this.get("transitionOut"),s=t.get("transitionIn")===this.defaults.transitionIn?"fadeInLeft":t.get("transitionIn");this.close({transition:i}),setTimeout(function(){t.open({transition:s})},200)}}},{key:"bindTrigger",value:function(){var t=this,e=this.getTriggerElement();e.length&&(this.get("ajax")||this.get("contentAjax")&&!1===this.contentAjaxLoaded?this.bindTriggerAjax():e.off("click.exo.modal."+this.getId()).on("click.exo.modal."+this.getId(),function(e){e.preventDefault(),t.toggle()}).off("keydown.exo.modal."+this.getId()).on("keydown.exo.modal."+this.getId(),function(e){switch(e.which){case 13:case 32:e.preventDefault(),e.stopPropagation(),t.toggle()}}))}},{key:"bindTriggerAjax",value:function(){var e=this.getTriggerElement();if(e.length){var t=this.get("ajax")?this.get("ajax"):this.get("contentAjax"),i=this.addDestination(x.url(t)),s={progress:{type:"fullscreen"},base:e.attr("id"),element:e[0],url:i,exoModal:this,event:"click.exo.modal."+this.getId()};x.ajax(s)}}},{key:"addDestination",value:function(e){var t=e.split("?"),i=null;if(t[1]&&(i=new URLSearchParams("?"+t[1]).get("destination")),!i){var s="destination",n=window.location.pathname;s=encodeURI(s),n=encodeURI(n);var o=e&&-1!==e.indexOf("?");e+=(o?"&":"?")+s+"="+n}return e}},{key:"isOpen",value:function(){return this.state===this.states.OPENED||this.state===this.states.OPENING}},{key:"getState",value:function(){return this.state}},{key:"getSelector",value:function(){return this.getId().replace(/_/g,"-")}},{key:"getSelectorAsId",value:function(){return"#"+this.getSelector()}},{key:"getTriggerElement",value:function(){return this.$trigger=v("."+this.getSelector()+"-trigger"),this.$trigger}},{key:"getElement",value:function(){var e=v("."+this.getSelector());return this.$element=e.first(),1<e.length&&e.each(function(e,t){0!==e&&v(t).remove()}),this.$element}}]),i}(),i=function(){function s(){var e;return _classCallCheck(this,s),(e=_possibleConstructorReturn(this,_getPrototypeOf(s).call(this))).label="Modals",e.doDebug=!1,e.settingsGroup="exoModal",e.instanceSettingsGroup="modals",e.instanceClass=t,e.globalWrapper="#exo-modals",e.events={opening:new ExoEvent,opened:new ExoEvent,closing:new ExoEvent,closed:new ExoEvent},e.$wrapper=v(e.globalWrapper),e.buildBindings(),e}return _inherits(s,ExoDataManager),_createClass(s,[{key:"addInstance",value:function(e,t){var i=this;t.event("opening").on("modals",function(e){i.event("opening").trigger(e),e.get("appendTo")===i.globalWrapper&&i.$wrapper.addClass("exo-modals-active").attr("aria-hidden","false")}),t.event("opened").on("modals",function(e){i.event("opened").trigger(e)}),t.event("closing").on("modals",function(e){i.event("closing").trigger(e)}),t.event("closed").on("modals",function(e){i.event("closed").trigger(e),0===i.getVisible(!0).count()&&i.$wrapper.removeClass("exo-modals-active").attr("aria-hidden","true")}),_get(_getPrototypeOf(s.prototype),"addInstance",this).call(this,e,t)}},{key:"buildBindings",value:function(){var s=this;x.Exo.$document.off("keydown.exo.modal").on("keydown.exo.modal",function(i){s.getVisible().each(function(e){var t=v(i.target);if(e.getElement().find(i.target).length)if(13===i.which&&e.getElement().find("form").length){if(t.has("[data-autocomplete-path]").length||t.hasClass("ui-autocomplete-input")||t.is("textarea"))return;e.getElement().find("form .form-submit:first").mousedown()}else 27===i.which&&e.get("closeOnEscape")&&e.close()})}),x.Exo.$document.off("keyup.exo.modal").on("keyup.exo.modal",function(t){var e=t.target;t.ctrlKey||t.metaKey||t.altKey||"INPUT"===e.tagName.toUpperCase()||"TEXTAREA"==e.tagName.toUpperCase()||s.getVisible().each(function(e){e.get("group")&&1<x.ExoModal.getGrouped(e.get("group")).count()&&(37===t.which?e.prev(t):39===t.which&&e.next(t))})}),x.ExoDisplace.event("changed").on("exo.modal",function(e){s.resizeWrapper()})}},{key:"closeAll",value:function(){this.getVisible().each(function(e){e.close()})}},{key:"close",value:function(e){var t=this.getInstance(e);t?t.close():this.debug("error","Count not find modal to close",e)}},{key:"getVisible",value:function(t){var i=this,s=new ExoDataCollection;return t=!0===t,this.getInstances().each(function(e){e.isOpen()&&(!1===t||!0===t&&e.get("appendTo")===i.globalWrapper)&&s.add(e)}),s}},{key:"getVisibleFocus",value:function(e){new ExoDataCollection;var i=0,s=null;return this.getVisible(e).each(function(e){var t=e.get("zindex");i<=t&&(i=t,s=e)}),s}},{key:"getById",value:function(i){var s=this;return new Promise(function(t,e){s.getInstances().each(function(e){e.getId()===i&&t(e)})})}},{key:"getGrouped",value:function(t){var i=new ExoDataCollection;return""!==t&&this.getInstances().each(function(e){e.get("group")===t&&i.add(e)}),i}},{key:"getWrapper",value:function(){return this.$wrapper}},{key:"resizeWrapper",value:function(){this.getWrapper().css({top:x.ExoDisplace.offsets.top,bottom:x.ExoDisplace.offsets.bottom,left:x.ExoDisplace.offsets.left,right:x.ExoDisplace.offsets.right})}},{key:"event",value:function(e){return void 0!==this.events[e]?this.events[e].expose():null}}]),s}();x.ExoModal=new i,x.behaviors.exoModal={attach:function(e){x.ExoModal.attach(e);var t=x.ExoModal.getVisibleFocus();t&&t.getElement().find(e).length&&t.refreshContent()}}}(jQuery,_,Drupal,drupalSettings,Drupal.displace);